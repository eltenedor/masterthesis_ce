  \section{Finite Volume Method for Incompressible Flows -- Segregated Approach}

  The purpose of this section is to present the discretization applied to the set of equations (\ref{eq:completeset}). The applied discretization techniques depend on the different terms of each equation, thus at first every equation will be discretized individually. The finite volume method relies on the discretization of integral equations, which will be derived at the beginning of each subsection that relies on them. Since the system of partial differential equations to be solved always exhibits coupling at least between the dependent variables pressure and velocity a first solution algorithm, namely the \textit{SIMPLE} algorithm addressed to resolve the pressure velocity coupling is introduced. The efficient coupling of the Navier-Stokes equations to the temperature equation is one part of the present thesis and will be addressed in a separate subsection. Furthermore every problem modelled by partial differential equations needs to provide valid boundary conditions. The discretization of those boundary conditions, that are relevant for the present thesis will be presented in their own subsection.

    \subsection{Discretization of the Mass Balance}

    Integration of equation (\ref{eq:contidiff}) over the integration domain of a single control volume \(P\) yields after the application of Gauss' integration theorem and the additivity of the Riemann integral
    \begin{displaymath}
      \iint\limits_S  u_i n_i \mathrm{d}S = \sum_{f \in \{w,s,b,t,n,e\}} \iint\limits_{S_f}  u_i n_{i} \mathrm{d}S = 0
    \end{displaymath}
    In the present work the mass balance is discretized using the midpoint rule for the surface integrals and linear interpolation of the velocity to to center of mass of the surface. This leads to the following form of the mass balance: 
    \begin{align*}
      \sum_{f \in \{w,s,b,t,n,e\}} u_{i_f} n_{f_i} S_f 
      &= u_{i_w} n_{w_i} S_w + u_{i_e} n_{e_i} S_e 
       + u_{i_s} n_{s_i} S_s + u_{i_n} n_{n_i} S_n 
       + u_{i_b} n_{b_i} S_b + u_{i_t} n_{t_i} S_t  \\
      &= ( \gamma_w u_{i_W} + (1 - \gamma_w ) u_{i_P} ) n_{w_i} S_w + ( \gamma_s u_{i_S} + (1 - \gamma_s ) u_{i_P} ) n_{s_i} S_s \\
      &\quad + ( \gamma_b u_{i_B} + (1 - \gamma_b ) u_{i_P} ) n_{b_i} S_b + ( \gamma_t u_{i_T} + (1 - \gamma_t ) u_{i_P} ) n_{t_i} S_t \\
      &\quad + ( \gamma_n u_{i_N} + (1 - \gamma_n ) u_{i_P} ) n_{n_i} S_n + ( \gamma_e u_{i_E} + (1 - \gamma_e ) u_{i_P} ) n_{e_i} S_e \\
      & =  0,
    \end{align*}
    where \( \gamma_f \) for \( f \in \{w,e,s,n,b,t\} \) is the geometrical interpolation factor.

    \subsection{Discretization of the Momentum Balance}

      The stationary momentum balance integrated over a single control volume \(P\) reads as
      \begin{displaymath}
        \underbrace{\iint\limits_S (\rho u_i u_j)n_j \mathrm{d}S}_{\text{convective term}}
        - \underbrace{\iint\limits_S \left(\mu \left( \frac{\partial u_i}{\partial x_j} + \frac{\partial u_j}{\partial x_i}\right)\right)n_j \mathrm{d}S}_{\text{diffusive term}}
        = - \overbrace{\iiint_V \frac{\partial p}{\partial x_i} \mathrm{d}V}^{\text{sourceterm pressure}}
        - \overbrace{\iiint_V \rho \beta \left(T - T_0\right) \mathrm{d}V}^{\text{sourceterm temperature}}
      \end{displaymath}
      where the different terms to be addressed individually in the following sections are indicated. Note that the form of this equation has been modified by using Gauss' integration theorem The terms residing on the left will be treated in an implicit manner whereas the terms on the right will be treated explicitly. 

      \subsubsection{Calculation of Mass Flux -- Rhie-Chow Interpolation}

      \subsubsection{Linearization and Discretization of the Convective Term}

      The convective term \(\rho u_i u_j\) of the Navier-Stokes equations is the reason for the non-linearity of the equations. In order to deduce a set of linear algebraic equations from the Navier-Stokes equations this term has to be linearized. As introduced in section (\ref{sec:nonlinear}), the non linearity will be dealt with by means of an iterative process, the Picard iteration. The part dependent of the non dominant dependent variable therefore will be approximated by its value from the previous iteration as \( \rho u_i^{(n)} u_j^{(n)} \approx \rho u_i^{(n)} u_j^{(n-1)} \). However this linearization will not be directly visible because it will be covered by the mass flux \(\dot{m}_f = \iint\limits_{S_f} \rho u_j^{(n-1)} n_j \mathrm{d}S \). Using the additivity of the Riemann integral the first step is to decompose the surface integral into individual contributions from each boundary face of the control volume \(P\)
      \begin{displaymath}
      \iint\limits_S (\rho u_i u_j)n_j \mathrm{d}S
      = \sum_{f \in \{w,s,b,t,n,e\}} \iint\limits_{S_f}\rho u_{i} u_{j} n_{j} \mathrm{d}S
      = \sum_{f \in \{w,s,b,t,n,e\}} F_{i,f}^{c}
      \end{displaymath}
      where \(F_{i,f}^c := \iint\limits_{S_f} \rho u_{i}^{(n)} u_{j}^{(n-1)} n_{j} \mathrm{d}S \) is the convective flux of the velocity \(u_i\) through the face \(S_f\). 
      
      To improve diagonal dominance of the resulting linear system while maintaining the smaller discretization error of a higher order discretization, a blended discretization scheme is applied using a deferred correction. Since due to the non-linearity of the equations to be solved an iterative solution process is needed by all means, the overall convergence doesn't degrade noticeably when using a deferred correction. Blending and deferred correction result in a decomposition of the convective flux into a lower order approximation that is treated implicitly and the explicit difference between the higher and lower order approximation for the same convective flux. Since for coarse grid resolutions the use of higher order approximations may lead to oscillations of the solution which may degrade or even impede convergence, the schemes can be blended by a control factor \( \eta \in [0,1]\). To show the generality of this approach all further derivations are presented for the generic boundary face \(S_f\) that separates control volume \(P\) from its neighbour \(F \in NB(P)\). This decomposition then leads to
      \begin{displaymath}
        F_{i,f}^c \approx  \underbrace{F_{i,f}^{c,l}}_{\text{implicit}} + \eta \bigl[\underbrace{ F_{i,f}^{c,h} - F_{i,f}^{c,l} }_{\text{explicit}}\bigr]^{(n-1)}.
      \end{displaymath}
      Note that the convective fluxes carrying a \(l\) or \(h\) as exponent, already have been linearized and discretized. The discretization applied to the convective flux in the present work is using the midpoint integration rule and blends the upwind interpolation scheme with the linear interpolation scheme. Applied to above decomposition one can derive the following approximations
      \begin{align*}
        F_{i,f}^{c,l} &= u_{i,F} \min(\dot{m}_f ,0) + u_{i,P} \max(0,\dot{m}_f) \\
        F_{i,f}^{c,h} &= u_{i,F} \gamma_f + u_{i,P} (1 - \gamma_f),
      \end{align*}
      where the variable values have to be taken from the previous iteration step \((n-1)\) as necessary and the mass flux \(\dot{m}_f\) has been used as result of the linearization process. The results can now be summarized by presenting the convective contribution to the matrix coefficients \(a_{F,u_i}\) and \(a_{P,u_i}\) and the right hand side \(b_{P,u_i}\) which are calculated as
      \begin{subequations}
      \begin{align}
        a_{F,u_i}^c &= \min(\dot{m}_f ,0), \quad \quad a_{P,u_i}^c = \sum_{F \in NB(P)} \max(0,\dot{m}_f) \\[1em]
        b_{P,u_i}^c &= \sum_{F \in NB(P)} \eta  \left(u_{i,F)}^{(n-1)} \left( \min(\dot{m}_f,0) - \gamma_f \right)\right) \nonumber \\
                    &\quad \quad \quad  \quad+ \eta \left( u_{i,P}^{(n-1)} \left( \max(0,\dot{m}_f) - \left(1 - \gamma_f\right) \right)\right)
      \end{align}
    \end{subequations}

      \subsubsection{Discretization of the Diffusive Term}

      The diffusive term contains the first partial derivatives of the velocity as result of the material constitutive equation that characterizes the behaviour of Newtonian fluids. As pointed out in section \ref{sec:nonorth} directional derivatives can be discretized using central differences on orthogonal grids or in the more general case of non-orthogonal grids using central differences implicitly and a explicit deferred correction comprising the non-orthogonality of the grid. As seen in equation (\ref{eq:navierstokes}) the diffusive term of the Navier-Stokes equations can be simplified using the mass balance in the case of an incompressible flow with constant viscosity \(\mu\). To sustain the generality of the presented approach this simplification will be omitted.
    

      As before, by using the additivity and furthermore linearity of the Riemann integral, the integration of the diffusive term will be divided into integration over individual boundary faces \(S_f\) 
      \begin{displaymath}
      \iint\limits_S \left(\mu \left( \frac{\partial u_i}{\partial x_j} + \frac{\partial u_j}{\partial x_i}\right)\right)n_j \mathrm{d}S \mathrm{d}S
      = \sum_{f \in \{w,s,b,t,n,e\}} \left[
        \iint\limits_{S_f} \mu \underline{\frac{\partial u_i}{\partial x_j}n_j \mathrm{d}S}
    + \iint\limits_{S_f} \mu \frac{\partial u_j}{\partial x_i}n_j \mathrm{d}S \right]
       = \sum_{f \in \{w,s,b,t,n,e\}} F_{i,f}^{d},
      \end{displaymath}
      where \(F_{i,f}^{d}\) denotes the diffusive flux through an individual boundary face. Section \ref{sec:nonorth} only covered the non-orthogonal corrector for directional derivatives. Since the velocity is a vector field and not a scalar field, the results of section \ref{sec:nonorth} may only be applied to the underlined term. The other term will be treated explicitly since it is considerably smaller than the underlined term and does not cause oscillations and thus will not derogate convergence. To begin with all present integrals will be approximated using the midpoint rule of integration. The diffusive flux \(F_{i,f}^d\) for a generic face \(S_f\) then reads 
      \begin{displaymath}
        F_{i,f}^d \approx \mu \underline{\left(\frac{\partial u_i}{\partial x_j}\right)_f n_j S_f} + \mu \left(\frac{\partial u_j}{\partial x_i}\right)_f n_j S_f.
      \end{displaymath}

      Using central differences for the implicit discretization of the directional derivative and furthermore using the \textit{orthogonal correction} approach from \ref{seq:orthcorrapproach} the approximation can be derived as
      \begin{align*}
        F_{i,f}^d 
        &\approx 
        \mu \left( \underline{||\vecg{\vecg{\Delta}_f}||_2 \frac{u_{P_i} - u_{F_i}}{ || \vec{x}_P - \vec{x}_F ||_2 }  
        -  \left(\nabla u_i \right)_f^{(n-1)} \cdot \left(\vecg{\Delta}_f - \vec{S}_f\right)  }  \right)
        + \mu \left( \frac{\partial u_j}{\partial x_i} \right)_f^{(n-1)} n_{f_i} \\[1em]
        &= \mu \left(\underline{  S_f \frac{u_{P_i} - u_{F_i}}{ || \vec{x}_P - \vec{x}_F ||_2 }  
    - \left( \frac{\partial u_i}{\partial x_j}\right)_f^{(n-1)} \left(\xi_{f_i} - n_{f_i}\right)S_f  } \right)
      + \mu \left( \frac{\partial u_j}{\partial x_i} \right)_f^{(n-1)} n_{f_i}
    \end{align*}
      where
      \begin{displaymath}
        \vecg{\xi}_f = \frac{\vec{x}_P - \vec{x}_F}{|| \vec{x}_p - \vec{x}_F ||_2}
      \end{displaymath}
      denotes the unit vector pointing in direction of the straight line connecting control volume \(P\) and control volume \(F\). The interpolation of the cell center gradients to the boundary faces is performed as in (\ref{eq:interpolgrad}). Now the contribution of the diffusive part to matrix coefficients and the right hand side can be calculated as:
      \begin{subequations}
        \begin{align}
          a_{F,u_i}^d &= - \frac{\mu S_f}{||\vec{x}_P - \vec{x}_F||_2}, 
          \quad \quad a_{P,u_i}^d = \sum_{F \in NB(P)} \frac{\mu S_f}{|| \vec{x}_P - \vec{x}_F ||} \\[1em]
          b_{F,u_i}^d &=   \left( \frac{\partial u_i}{\partial x_j}\right)_f^{(n-1)} \left(\xi_{f_i} - n_{f_i}\right)S_f  
          - \mu \left( \frac{\partial u_j}{\partial x_i} \right)_f^{(n-1)} n_{f_i} S_f   \nonumber \\[0.5em]
          &=   \left( \frac{\partial u_i}{\partial x_j}\right)_f^{(n-1)} \xi_{f_i} S_f
          - \mu \left( \left( \frac{\partial u_i}{\partial x_j} \right)_f^{(n-1)}
          - \left( \frac{\partial u_j}{\partial x_i} \right)_f^{(n-1)} \right) n_{f_i} S_f 
        \end{align}
      \end{subequations}

      \subsubsection{Discretization of the Source Term}

      \subsubsection{Assembly of Linear Systems -- Final Form of Equations}
        Coefficients of matrices for momentum are identical except in case of different factors for under-relaxation (underrelaxation (Andersson) )(when does this happen) for the main diagonal coefficient. Small example in code, then show image of assembled system.

    \subsection{Discretization of the Generic Transport Equation}

    \subsection{The SIMPLE-Algorithm}
      
      \subsubsection{Pressure Correction Equation}

      \subsubsection{Characteristic Properties of Projection Methods}

        Under-relaxation, slow convergence, inner iterations outer iterations, relative tolerances, also talk about staggered and collocated variable positioning

      \subsubsection{Dependence on Under-Relaxation -- The Pressure-Weighted Interpolation Method}

        Present an approach for Under-Relaxation independent converged solution. Conduct the proof to show it really works. Present the results for different under-relaxation factors

      \subsubsection{Coupling of Temperature Equation}

        Explicit coupling through source term in momentum balances (Boussinesq-Approximation)

    \subsection{Boundary Conditions on Domain and Block Boundaries}

        Introduce chapter by talking about the nature of partial differential equations (Hackbusch). Always start with a simple implementation for the generic transport equation, then specialize to Navier-Stokes equation.

      \subsubsection{Dirichlet Boundary Condition}

        Only talk about dirichlet for velocities not for pressure.

      %\subsubsection{Neumann Boundary Condition}

        Problematics of outlet boundary conditions

      %\subsubsection{Symmetry Boundary Condition}

      \subsubsection{Wall Boundary Condition}

      Note that there are different approaches. Explain which approach is used and why (memory efficiency)

      \subsubsection{Block Boundary Condition}

      Relevant for block structured grids as for the validity of the domain composition.
      
