\chapter{Implicit Finite-Volume Method for Incompressible Flows -- Segregated Approach}
\label{sec:seg}
In this chapter, an algorithm, addressed to resolve the pressure-velocity coupling, is introduced. Furthermore, this chapter proposes a method of calculating mass fluxes by interpolation. This method is independent of under-relaxation. In addition, this chapter presents the detailed derivation of all coefficients that result from the discretization process. Finally, this chapter shows the boundary conditions which are relevant to the present thesis. 

\section{Discretization of the Mass Balance}

Integration of equation (\ref{eq:contidiff}) over the integration domain of a single control volume \(P\), after the application of Gauss's theorem of integration and the additivity of the Riemann integral, yields
\begin{displaymath}
  \iint\limits_{S_f} u_i n_i \mathrm{d}S = \sum_{f \in \{w,s,b,t,n,e\}} \iint\limits_{S_f} u_i n_{i} \mathrm{d}S = 0.
\end{displaymath}
In the present work, the mass balance is discretized using the midpoint integration rule for the surface integrals and linear interpolation of the velocity to the center of mass of the boundary surface \(S_f\). These approximations lead to the following form of the mass balance
\begin{align}
  \label{eq:massbalance}
  \sum_{f \in \{w,s,b,t,n,e\}} u_{i,f} n_{f_i} S_f = 0,
\end{align}
where no interpolation to attain the values of \(u_i\) at the face \(S_f\) has been performed yet since the straightforward linear interpolation will lead to undesired oscillations in the solution fields. Section \ref{sec:massflux} presents an interpolation method to circumvent this so-called \emph{checker-boarding} effect.

\section{A Pressure-Weighted Interpolation Method for Velocities}
\label{sec:massflux}

A cell-centered variable arrangement simplifies the treatment of non-orthogonal grids \cite{ferziger02,schaefer99}. However, a major deficiency of cell-centered variable arrangements is that the pressure field may delink. This deficiency will then lead to unphysical oscillations in both the pressure and the velocity results. If the oscillations are severe enough, the solution algorithm might even get unstable and diverge. The described decoupling occurs, when the pressure gradient in the momentum balances, and the mass fluxes in the continuity equation are discretized using central differences. 
  
A common practice to eliminate this behavior is the use of a momentum interpolation technique, also known as \emph{Rhie-Chow Interpolation} \cite{rhie82}. However, the original interpolation scheme does not guarantee a unique solution, independent of the amount of under-relaxation. The performance of one of the algorithms used in the present thesis heavily relies on the under-relaxation of variables in order to accomplish stability. The present section addresses these issues by offering an interpolation method that suppresses oscillations and at the same time assures an under-relaxation independent solution: the \emph{pressure-weighted interpolation method} \cite{choi99,choi03,majumdar88,miller88,zhang14}.

The derivation of the pressure-weighted interpolation method builds on the discretized momentum balances at node \(P\) and an arbitrary neighboring node \(Q \in NB(P)\). Section \ref{sec:segdiscretization} handles the discretization used within finite-volume methods and describes the incorporation of under-relaxation factors. The semi-discrete implicit momentum balances for the velocity at node \(P\) and \(Q\) read
%\begin{subequations}
\begin{align*}
    u_{i,P}^{(n)} 
    &= 
    - \frac{\alpha_{\vec{u}}}{a_P^{u_i}} \left(\sum_{F \in NB(P)} a_F^{u_i} u_{i,F}^{(n)}
    +                                     b_{P,u_i}^{(n-1)} 
    -                                     V_P\left(\frac{\partial p}{\partial x_i}\right)_P^{(n-1)} \right)
    + \left(1 - \alpha_{\vec{u}}\right) u_{i,P}^{(n-1)}  \\[1em]
    \text{and} \quad
    u_{i,Q}^{(n)} 
    &= 
    - \frac{\alpha_{\vec{u}}}{a_Q^{u_i}} \left(\sum_{F \in NB(Q)} a_F^{u_i} u_{i,F}^{(n)}
    +                                     b_{Q,u_i}^{(n-1)} 
    -                                     V_Q\left(\frac{\partial p}{\partial x_i}\right)_Q^{(n-1)}   \right)
    + \left(1 - \alpha_{\vec{u}}\right) u_{i,Q}^{(n-1)} \quad.
\end{align*}
%\end{subequations}
Here, the superscript \((n-1)\) indicates the use of variable values of the previous outer iteration. The pressure gradient has not been discretized yet. A selective interpolation technique \cite{schaefer99} can be applied. This interpolation is crucial for the prevention of the mentioned oscillations. In almost the same way, a semi-discrete implicit momentum balance can be formulated for a virtual control volume located between nodes \(P\) and \(Q\). \begin{equation}
  \label{eq:virtualu}
  u_{i,f}^{(n)} 
  = 
  - \frac{\alpha_{\vec{u}}}{a_f^{u_i}} \left(\sum_{F \in NB(f)} a_F^{u_i} u_{i,F}^{(n)} 
  +                                     b_{f,u_i}^{(n-1)} 
  -                                     V_f\left(\frac{\partial p}{\partial x_i}\right)_f^{(n-1)}  \right)
  + \left(1 - \alpha_{\vec{u}}\right) u_{i,f}^{(n-1)}.
\end{equation}
Figure \ref{fig:virt} gives an interpretation of the virtual control volume which shows that the motivation of this interpolation method comes form staggered variable arrangements, as figure \ref{fig:cellvertex} suggests.

\begin{figure}[h]
  \input{./img/virt.tikz.tex}
  \centering{}
  \caption{Interpretation of a virtual control volume (gray) located between nodes $P$ and $Q$ }
  \label{fig:virt}
\end{figure}

To guarantee convergence of this expression for \(u_{i,f}\), under-relaxation is necessary \cite{majumdar88}. In order to eliminate the undefined artifacts surging from the virtualization of a control volume, the following assumptions have to be made to derive a closed expression for the velocity on the boundary face \(S_f\):
\begin{subequations}
\label{eq:approxpwim}
\begin{align}
  \frac{\alpha_{\vec{u}}}{a_f^{u_i}} \left(\sum_{F \in NB(f)} a_F^{u_i} u_{i,F}^{(n)} \right)
  &\approx
  \left(1-\gamma_f\right) \frac{\alpha_{\vec{u}}}{a_P^{u_i}} \left(\sum_{F \in NB(P)} a_F^{u_i} u_{i,F}^{(n)} \right)
  +
  \gamma_f \frac{\alpha_{\vec{u}}}{a_Q^{u_i}} \left(\sum_{F \in NB(Q)} a_F^{u_i} u_{i,F}^{(n)} \right), \\[1em]
  \quad
  \frac{\alpha_{\vec{u}}}{a_f^{u_i}}b_{f,u_i}^{(n-1)} 
  &\approx
  \left(1-\gamma_f\right) \frac{\alpha_{\vec{u}}}{a_P^{u_i}} b_{P,u_i}^{(n-1)} 
  +
  \gamma_f \frac{\alpha_{\vec{u}}}{a_Q^{u_i}} b_{Q,u_i}^{(n-1)} \\[1em]
  \text{and}
  \quad
  \frac{\alpha_{\vec{u}}}{a_f^{u_i}} 
  &\approx
  \left(1-\gamma_f\right) \frac{\alpha_{\vec{u}}}{a_P^{u_i}} 
  +
  \gamma_f \frac{\alpha_{\vec{u}}}{a_Q^{u_i}},
\end{align}
\end{subequations}
where \(\gamma_f\) is a geometric interpolation factor. 

By using the assumptions from equation (\ref{eq:approxpwim}), the expression in equation (\ref{eq:virtualu}) can be closed, so that the resulting equation will only depend on the variable values in node \(P\) and \(Q\)
\begin{align}
  \allowdisplaybreaks
  \label{eq:closepwim}
  u_{i,f}^{(n)} 
  &\approx 
  \left(1-\gamma_f\right)  \left( -\frac{\alpha_\vec{u}}{a_P^{u_i}} \sum_{F \in NB(P)} a_F^{u_i} u_{i,F}^{(n)} \right)
  +\gamma_f  \left( -\frac{\alpha_\vec{u}}{a_Q^{u_i}} \sum_{F \in NB(Q)} a_F^{u_i} u_{i,F}^{(n)}  \right) \nonumber \\[1em]
  &\quad\quad+ \frac{\alpha_\vec{u}}{a_f^{u_i}}b_{f,u_i}^{(n-1)} 
  - \frac{\alpha_{\vec{u}}}{a_f^{u_i}}V_f\left(\frac{\partial p}{\partial x_i}\right)_f^{(n-1)} 
  + \left(1 - \alpha_{\vec{u}}\right) u_{i,f}^{(n-1)} \nonumber \\[1em]
  &=
  \left(1-\gamma_f\right) u_{i,P}^{(n)} - \left(1 - \gamma_f\right) \frac{\alpha_{\vec{u}}}{a_P^{u_i}}\left(  b_{P,u_i}^{(n-1)} - V_P \left(\frac{\partial p}{\partial x_i}\right)_P^{(n-1)} \right) 
  +\gamma_f  u_{i,Q}^{(n)} - \gamma_f \frac{\alpha_{\vec{u}}}{a_Q^{u_i}} \left( b_{Q,u_i}^{(n-1)} - V_Q \left(\frac{\partial p}{\partial x_i}\right)_Q^{(n-1)}  \right) \nonumber \\[1em]
  &\quad\quad+ \frac{\alpha_{\vec{u}}}{a_f^{u_i}}b_{f,u_i}^{(n-1)} 
  - \frac{\alpha_{\vec{u}}}{a_f^{u_i}}V_f\left(\frac{\partial p}{\partial x_i}\right)_f^{(n-1)}
  + \left(1 - \alpha_{\vec{u}}\right) u_{i,f}^{(n-1)} 
  + \left(1 - \alpha_{\vec{u}}\right) \left(1 - \gamma_f\right) u_{i,P} + \left(1 - \alpha_{\vec{u}} \right) \gamma_f u_{i,Q} \nonumber \\[1em]
  &=
  \left[\left(1 - \gamma_f\right) u_{i,P}^{(n)} + \gamma_f u_{i,Q}^{(n)} \right] \nonumber\\[1em]
  &\quad\quad - 
  \left[ 
  \left(\left(1 - \gamma_f\right) \frac{\alpha_\vec{u} V_P}{a_P^{u_i}} + \gamma_f \frac{\alpha_\vec{u} V_Q}{a_Q^{u_i}}\right)
  \left(\frac{\partial p}{\partial x_i}\right)_f^{(n-1)} 
  - \left(1 - \gamma_f \right) \frac{\alpha_\vec{u} V_P}{a_P^{u_i}}\left( \frac{\partial p}{\partial x_i} \right)_P^{(n-1)} 
  - \gamma_f \frac{\alpha_\vec{u} V_Q}{a_Q^{u_i}}\left(\frac{\partial p}{\partial x_i}\right)_Q^{(n-1)}
  \right] \nonumber \\[1em]
  &\quad\quad + \left(1 - \alpha_\vec{u}\right) \left[ u_{i,f}^{(n-1)} - \left(1 - \gamma_f\right) u_{i,P}^{(n-1)} - \gamma_f \, u_{i,Q}^{(n-1)} \right] \nonumber \\[1em]
  &\approx
  \left[\left(1 - \gamma_f\right) u_{i,P}^{(n)} + \gamma_f u_{i,Q}^{(n)} \right] \nonumber\\[1em]
  &\quad\quad - 
  \left(\left(1 - \gamma_f\right) \frac{\alpha_\vec{u} V_P}{a_P^{u_i}} + \gamma_f \frac{\alpha_\vec{u} V_Q}{a_Q^{u_i}}\right)
  \left[ 
    \underline{\left(\frac{\partial p}{\partial x_i}\right)_f^{(n-1)} 
  - \left(1 - \gamma_f \right) \left( \frac{\partial p}{\partial x_i} \right)_P^{(n-1)} 
- \gamma_f \left(\frac{\partial p}{\partial x_i}\right)_Q^{(n-1)}}
  \right] \nonumber \\[1em]
  &\quad\quad + \left(1 - \alpha_\vec{u}\right) \left[ u_{i,f}^{(n-1)} - \left(1 - \gamma_f\right) u_{i,P}^{(n-1)} - \gamma_f \, u_{i,Q}^{(n-1)} \right].
\end{align}
The task of the underlined pressure gradient corrector in equation (\ref{eq:closepwim}) is to suppress oscillations in the pressure field. If there are no oscillations, this part should not become active. As long as the behavior of this corrector remains consistent, i.e. that there are no oscillations in the pressure field within a converged solution, it can be multiplied by arbitrary constants \cite{ferziger02}. The modification applied in the last step of the derivation of equation \ref{eq:closepwim} makes use of this fact. The previous argumentation is only valid on equidistant grids, where \(\gamma_f = 1/2\) and central differences are used to calculate the gradients. On arbitrary non-orthogonal grids, another modification has to be performed which is based on a special case of the mean value theorem of differential calculus and the following 
\begin{prop}
  Let \(x_1,x_2 \in \mathbb{R}\) with \(x_1 \neq x_2\) and \(p(x) = a_0 + a_1 x + a_2 x^2\) a real polynomial function. Then 
  \begin{displaymath}
    \frac{dp}{dx}\left(\frac{x_1+x_2}{2}\right) = \frac{p(x_2) - p(x_1)}{x_2 - x_1},
  \end{displaymath}
  i.e. the slope of the secant equals the value of the first derivative of \(p\) exactly half the way between \(x_1\) and \(x_2\).
\end{prop}

\begin{proof}
On the one hand, the evaluation of the derivative yields
\begin{displaymath}
    \frac{dp}{dx}\left(\frac{x_1+x_2}{2}\right) = a_1 + 2 a_2 \frac{x_1 + x_2}{2} = a_1 + a_2(x_1 + x_2).
\end{displaymath}
On the other hand, the slope of the secant, using the third binomial rule can be expressed as
\begin{displaymath}
  \begin{array}{ll}
  \frac{p(x_2) - p(x_1)}{x_2 - x_1} 
&= \frac{a_0 + a_1 x_2 + a_2 x_2^2 - \left(a_0 + a_1 x_1 + a_2 x_1 ^2\right)}{x_2 - x_1} \\[1.0em]
  \quad &= \frac{a_1 (x_2 - x_1) + a_2 \left(x_2^2 - x_1^2\right)}{x_2 - x_1} \\[1.0em]
  \quad &= a_1 + a_2 (x_2 + x_1).
\end{array}
\end{displaymath}
The comparison of both expressions completes the proof.
\end{proof}

It is desirable for the pressure corrector to vanish independently of the grid spacing if the profile of the pressure is quadratic and hence does not exhibit oscillations. According to the preceding proposition, this can be accomplished by modifying equation (\ref{eq:closepwim}) in order to average the pressure gradients from node \(P\) and \(Q\) instead of interpolating linearly
\begin{align}
  u_{i,f}^{(n)} 
  &=
  \left[\left(1 - \gamma_f\right) u_{i,P}^{(n)} + \gamma_f u_{i,Q}^{(n)} \right] \nonumber\\[1em]
  &\quad\quad - 
  \left(\left(1 - \gamma_f\right) \frac{\alpha_\vec{u} V_P}{a_P^{u_i}} + \gamma_f \frac{\alpha_\vec{u} V_Q}{a_Q^{u_i}}\right)
  \left[ 
  \left(\frac{\partial p}{\partial x_i}\right)_f^{(n-1)} 
  - \frac{1}{2} \left( \frac{\partial p}{\partial x_i} \right)_P^{(n-1)} 
  - \frac{1}{2} \left(\frac{\partial p}{\partial x_i}\right)_Q^{(n-1)}
  \right] \nonumber \\[1em]
  \label{eq:pwim}
  &\quad\quad + \underline{\left(1 - \alpha_\vec{u}\right) \left[ u_{i,f}^{(n-1)} - \left(1 - \gamma_f\right) u_{i,P}^{(n-1)} - \gamma_f \, u_{i,Q}^{(n-1)} \right]}.
\end{align}
When comparing the expression in equation (\ref{eq:pwdim}) with the standard interpolation scheme, it is evident that the underlined term is not taken into consideration usually \cite{ferziger02}. However, section \ref{sec:independence} shows that neglecting this term indeed creates under-relaxation factor dependent results. This section concludes with a final
\begin{prop}
  The pressure weighted momentum interpolation scheme (\ref{eq:pwim}) guarantees that the converged solution for \(u_{i,f}\) is independent of the velocity under-relaxation \(\alpha_\vec{u}\).
\end{prop}
\begin{proof}
  An equivalent formulation of (\ref{eq:pwim}) is given by
\begin{align*}
  \alpha_\vec{u} u_{i,f}^{(n-1)} + u_{i,f}^{(n-1)} - u_{i,f}^{(n)} 
  &=
  \alpha_\vec{u} \left[\left(1 - \gamma_f\right) u_{i,P}^{(n-1)} + \gamma_f \, u_{i,Q}^{(n-1)} \right] \\[1em]
  &\quad\quad + \left[\left(1 - \gamma_f\right) \left( u_{i,P}^{(n)} - u_{i,P}^{(n-1)}\right) + \gamma_f \left( u_{i,Q}^{(n)} - u_{i,Q}^{(n-1)} \right) \right] \nonumber\\[1em]
  &\quad\quad - 
  \alpha_\vec{u} \left(\left(1 - \gamma_f\right) \frac{ V_P}{a_P^{u_i}} + \gamma_f \frac{V_Q}{a_Q^{u_i}}\right)
  \left[ 
  \left(\frac{\partial p}{\partial x_i}\right)_f^{(n-1)} 
  - \frac{1}{2} \left( \frac{\partial p}{\partial x_i} \right)_P^{(n-1)} 
  - \frac{1}{2} \left(\frac{\partial p}{\partial x_i}\right)_Q^{(n-1)} 
  \right]. \nonumber
\end{align*}
  Upon convergence \(u_{i,P}^{(n)} \approx u_{i,P}^{(n-1)}\) and \(u_{i,f}^{(n)} \approx u_{i,f}^{(n-1)}\). This leads to
\begin{align*}
  \alpha_\vec{u} u_{i,f}^{(n-1)} 
  &=
  \alpha_\vec{u} \left[\left(1 - \gamma_f\right) u_{i,P}^{(n-1)} + \gamma_f \, u_{i,Q}^{(n-1)} \right] \\[1em]
  &\quad\quad - 
  \alpha_\vec{u} \left(\left(1 - \gamma_f\right) \frac{ V_P}{a_P^{u_i}} + \gamma_f \frac{V_Q}{a_Q^{u_i}}\right)
  \left[ 
  \left(\frac{\partial p}{\partial x_i}\right)_f^{(n-1)} 
  - \frac{1}{2} \left( \frac{\partial p}{\partial x_i} \right)_P^{(n-1)} 
  - \frac{1}{2} \left(\frac{\partial p}{\partial x_i}\right)_Q^{(n-1)} 
  \right], \nonumber
\end{align*}
which shows, after division by \(\alpha_\vec{u} > 0\), that \(u_{i,f}\) is independent of the under-relaxation factor.
\end{proof}

\section{Implicit Pressure-Correction and the SIMPLE-Algorithm}
\label{sec:simple}

Finite-volume methods aim at deducing a particular system of linear algebraic equations from a partial differential equation. In the case of the momentum balances, the general structure of the resulting linear equation reads as follows
\begin{displaymath}
  \label{eq:linfinal}
  u_{i,P}^{(n)} 
  = 
  - \frac{\alpha_{\vec{u}}}{a_P^{u_i}} \left(\sum_{F \in NB(P)} a_F^{u_i} u_{i,F}^{(n)}
  +                                     b_{P,u_i}^{(n-1)} 
  -                                     V_P\left(\frac{\partial p}{\partial x_i}\right)_P^{(n-1)} \right)
  + \left(1 - \alpha_{\vec{u}}\right) u_{i,P}^{(n-1)}.
\end{displaymath}
Here, the pressure gradient only has been discretized symbolically and \(b_{P,u_i}^{(n-1)}\) denotes the source term evaluated at the previous outer iteration.

At this stage, the equations are still coupled and nonlinear. As described in section \ref{sec:nonlinear}, the Picard iteration process can be used to linearize the equations. After this, every momentum balance equation only depends on the one dominant variable \(u_i\). Furthermore, the coupling of the momentum balances through the convective term \((u_i u_j)\) is resolved in the process of linearization. In the next step, the decoupled momentum balances can be solved sequentially for the dominant variable \(u_i\). All coefficients \(a_{\{P,F\}}^{u_i}\), the source term, and the pressure gradient will be evaluated explicitly by using results of the preceding outer iteration \((n-1)\). For the pressure gradient, this means to take the pressure of the antecedent outer iteration as an approximate for the following iteration. This approximate has to be corrected in an iterative way until all the nonlinear equations are fulfilled up to a specified tolerance. Section (\ref{sec:convergence}) presents a suitable convergence criterion and its implementation. This linearization process in conjunction with the pressure approximate leads to the linear equation 
\begin{equation}
  \label{eq:nodeinter}
  u_{i,P}^{(n*)} 
  = 
  - \frac{\alpha_{\vec{u}}}{a_P^{u_i}} \left(\sum_{F \in NB(P)} a_F^{u_i} u_{i,F}^{(n*)}
  +                                     b_{P,u_i}^{(n-1)} 
  -                                     V_P\left(\frac{\partial p}{\partial x_i}\right)_P^{(n-1)} \right)
  + \left(1 - \alpha_{\vec{u}}\right) u_{i,P}^{(n-1)}.
\end{equation}
Here, \((*)\) indicates that in order to fulfill the discretized mass balance
\begin{equation}
  \label{eq:contisemi}
  \sum_{F \in NB(P)} {u_i}_f^{(n)} n_i S_f = 0.
\end{equation}
the solution of this equation still needs to be corrected. Applying the procedure from section \ref{sec:massflux} to equation (\ref{eq:nodeinter}) results in the following expression for the face velocities after solving the discretized momentum balances 
\begin{align}
  \label{eq:faceinter}
  u_{i,f}^{(n*)} 
  &=
  \left[\left(1 - \gamma_f\right) u_{i,P}^{(n*)} + \gamma_f u_{i,Q}^{(n*)} \right] \nonumber \\[1em]
  &\quad\quad - 
  \left(\left(1 - \gamma_f\right) \frac{\alpha_\vec{u} V_P}{a_P^{u_i}} + \gamma_f \frac{\alpha_\vec{u} V_Q}{a_Q^{u_i}}\right)
  \left[ 
  \left(\frac{\partial p}{\partial x_i}\right)_f^{(n-1)} 
  - \left( 1 - \gamma_f \right) \left( \frac{\partial p}{\partial x_i} \right)_P^{(n-1)} 
  - \gamma_f \left(\frac{\partial p}{\partial x_i}\right)_Q^{(n-1)}
  \right] \nonumber \\[1em]
  &\quad\quad + \left(1 - \alpha_\vec{u}\right) \left[ u_{i,f}^{(n-1)} - \left(1 - \gamma_f\right) u_{i,P}^{(n-1)} - \gamma_f \, u_{i,Q}^{(n-1)} \right].
\end{align}
Here, the pressure from the previous outer iteration has been used as a pressure approximate for the pressure gradients.

The lack of an equation having the pressure as dominant variable leads to the necessity of altering the mass balance as the only equation left from the set of partial differential equations (\ref{eq:completeset}). Methods of this type are called projection methods \cite{ferziger02}. A common class of algorithms of this family of methods uses an equation for the additive pressure-correction \(p'\) instead of the pressure itself. These algorithms enforce continuity by additively correcting the velocities and the pressure with the correctors \(u_i'\) and \(p'\) to
\begin{displaymath}
  u_{i,P}^{(n)} =  u_{i,P}^{(n*)}  + u_{i,P}',\quad u_{i,f}^{(n)} =  u_{i,f}^{(n*)}  + u_{i,f}' \quad \text{and} \quad   p_P^{(n)} =  p_P^{(n-1)}  + p_P'.
\end{displaymath}
Similar expressions exist for the variable values located at node \(Q\). Now it is possible to formulate the discretized momentum balance for the corrected velocities and the corrected pressure as
\begin{equation}
  \label{eq:nodecorr}
  u_{i,P}^{(n)} 
  = 
  - \frac{\alpha_{\vec{u}}}{a_P^{u_i}} \left(\sum_{F \in NB(P)} a_F^{u_i} u_{i,F}^{(n)}
  +                                     b_{P,u_i}^{(n-1)} 
  -                                     V_P\left(\frac{\partial p}{\partial x_i}\right)_P^{(n)} \right)
  + \left(1 - \alpha_{\vec{u}}\right) u_{i,P}^{(n-1)}.
\end{equation}
The only difference to the equation which will be solved in the next outer iteration is that the source term \(b_{P,u_i}\) has not been updated yet. In the same way, the discretized momentum balance for the face velocity \(u_{i,f}\) can be formulated as
\begin{align}
  \label{eq:facecorr}
  u_{i,f}^{(n)} 
  &=
  \left[\left(1 - \gamma_f\right) u_{i,P}^{(n)} + \gamma_f u_{i,Q}^{(n)} \right] \nonumber\\[1em]
  &\quad\quad - 
  \left(\left(1 - \gamma_f\right) \frac{\alpha_\vec{u} V_P}{a_P^{u_i}} + \gamma_f \frac{\alpha_\vec{u} V_Q}{a_Q^{u_i}}\right)
  \left[ 
  \left(\frac{\partial p}{\partial x_i}\right)_f^{(n)} 
  -  \left(1 - \gamma_f\right) \left( \frac{\partial p}{\partial x_i} \right)_P^{(n)} 
  - \gamma_f \left(\frac{\partial p}{\partial x_i}\right)_Q^{(n)} 
  \right] \nonumber \\[1em]
  &\quad\quad + \left(1 - \alpha_\vec{u}\right) \left[ u_{i,f}^{(n-1)} - \left(1 - \gamma_f\right) u_{i,P}^{(n-1)} - \gamma_f \, u_{i,Q}^{(n-1)} \right].
\end{align}
To couple velocity and pressure correctors one can subtract equation (\ref{eq:nodeinter}) from (\ref{eq:nodecorr}) and equation (\ref{eq:faceinter}) from (\ref{eq:facecorr}) to get
\begin{align}
  \label{eq:nodeprime}
  u_{i,P}' 
  &=  
  - \frac{\alpha_{\vec{u}}}{a_P^{u_i}} \left(\underline{\sum_{F \in NB(P)} a_F^{u_i} u_{i,F}'}
  - V_P\left(\frac{\partial p'}{\partial x_i}\right)_P^{(n)} \right) \quad \text{and}\\[1em]
  \label{eq:faceprime}
  u_{i,f}' 
  &= 
  \left[\left(1 - \gamma_f\right) u_{i,P}' + \gamma_f u_{i,Q}' \right] 
  - 
  \left(\left(1 - \gamma_f\right) \frac{\alpha_\vec{u} V_P}{a_P^{u_i}} + \gamma_f \frac{\alpha_\vec{u} V_Q}{a_Q^{u_i}}\right)
  \left[ 
  \left(\frac{\partial p}{\partial x_i}\right)_f' 
  - \left( 1 - \gamma_f \right) \left( \frac{\partial p}{\partial x_i} \right)_P' 
  - \gamma_f \left(\frac{\partial p}{\partial x_i}\right)_Q' 
  \right].
\end{align}
The majority of the class of pressure-correction algorithms has these equations as a common basis. Each algorithm then introduces particular, distinguishable approximations of the velocity corrections that are, at the moment of solving for the pressure-correction, still unknown. The method used in the present work is the \emph{SIMPLE}-algorithm (\emph{Semi-Implicit Method for Pressure-Linked Equations}) \cite{patankar72}. The approximation which this algorithm performs is severe since the term containing the unknown velocity corrections is dropped entirely. The respective term has been underlined in equation (\ref{eq:nodeprime}). Since the global purpose of the presented method is to enforce continuity by implicitly calculating a pressure-correction, the velocity correction has to be expressed explicitly in terms of the pressure-correction. This can be accomplished by inserting equation (\ref{eq:nodeprime}) into equation (\ref{eq:faceprime}). This approach gives an update formula
\begin{align}
  \label{eq:velcorr}
  u_{i,f}' 
  &\approx 
  - \left(\left(1 - \gamma_f\right) \frac{\alpha_\vec{u} V_P}{a_P^{u_i}} + \gamma_f \frac{\alpha_\vec{u} V_Q}{a_Q^{u_i}}\right)
  \left(\frac{\partial p}{\partial x_i}\right)_f',
\end{align}
which is then, together with (\ref{eq:faceinter}), inserted into the discretized continuity equation (\ref{eq:contisemi}) to obtain
\begin{equation}
  \label{eq:presscorr}
  \sum_{F \in NB(P)} \left(\left(1 - \gamma_f\right) \frac{\alpha_\vec{u} V_P}{a_P^{u_i}} + \gamma_f \frac{\alpha_\vec{u} V_F}{a_F^{u_i}}\right)
  \left(\frac{\partial p}{\partial x_i}\right)_f' n_i S_f
  = b_{P,p}
  \quad.
\end{equation}
Here, the right-hand side \(b_{P,p}\) is defined as
\begin{equation}
  \label{eq:presscorrb}
  b_{P,p} := \sum_{F \in NB(P)} u_{i,f}^{(n*)} n_i S_f.
\end{equation}
The complete discretization of this equation, using central differences as approximation for the gradient of the pressure-correction, is straightforward and will be presented in section \ref{sec:segpresscorr}.

The approximation performed in the SIMPLE-algorithm affects convergence in a way that the pressure-correction has to be under-relaxed with a parameter \(\alpha_p \in (0,1]\)
\begin{equation}
  \label{eq:pressupdate}
  p_P^{(n)} = p_P^{(n-1)} + \alpha_{\vec{p}} p_P'.
\end{equation}

There exist better approximations for the pressure-correction which do not rely on pressure under-relaxation for convergence. On example that uses a more consistent approximation is the \emph{SIMPLEC}-algorithm (\emph{SIMPLE Consistent}) \cite{doormaal84}. \cite{miller88} gives a similar derivation of the pressure weighted interpolation method and its implementation in the SIMPLEC-algorithm.

As shown in section \ref{sec:massflux}, the behavior of the pressure weighted interpolation method on non-equidistant grids can be improved by replacing the linear interpolation of pressure gradients in equation (\ref{eq:faceinter}) by unweighted arithmetic averaging. This replacement leads to the following equation for calculating mass fluxes from face velocities
\begin{align}
  \label{eq:facecorr2}
  u_{i,f}^{(n*)} 
  &=
  \left[\left(1 - \gamma_f\right) u_{i,P}^{(n*)} + \gamma_f u_{i,Q}^{(n*)} \right] \nonumber\\[1em]
  &\quad\quad - 
  \left(\left(1 - \gamma_f\right) \frac{\alpha_\vec{u} V_P}{a_P^{u_i}} + \gamma_f \frac{\alpha_\vec{u} V_Q}{a_Q^{u_i}}\right)
  \left[ 
  \left(\frac{\partial p}{\partial x_i}\right)_f^{(n-1)} 
  -  \frac{1}{2} \left( \frac{\partial p}{\partial x_i} \right)_P^{(n-1)} 
  -  \frac{1}{2} \left(\frac{\partial p}{\partial x_i}\right)_Q^{(n-1)} 
  \right] \nonumber \\[1em]
  &\quad\quad + \left(1 - \alpha_\vec{u}\right) \left[ u_{i,f}^{(n-1)} - \left(1 - \gamma_f\right) u_{i,P}^{(n-1)} - \gamma_f \, u_{i,Q}^{(n-1)} \right].
\end{align}

The SIMPLE-algorithm can be represented by an iterative procedure as shown in Algorithm 1. If the solution algorithm includes a decoupled variable, i.e. a passively convected quantity it is preferable to solve for this variable after the application of the entire iterative solution algorithm for the velocity and pressure field. This approach reduces the number of linear solves for the scalar equation.

\alglanguage{pseudocode}
\begin{algorithm}
\label{al:simple}
\caption{SIMPLE-Algorithm}
\begin{algorithmic}
\State{\textit{INITIALIZE} variables}
\While{(convergence criterion not accomplished)}
\State{\textit{SOLVE} linearized momentum balances \textbf{(\ref{eq:nodeinter})}}
\State{\textit{CALCULATE} mass fluxes using \textbf{(\ref{eq:facecorr})} or \textbf{(\ref{eq:facecorr2}})}
\State{\textit{SOLVE} pressure-correction equation \textbf{(\ref{eq:presscorr})}to assure continuity }
\State{\textit{UPDATE} pressure using \textbf{(\ref{eq:pressupdate})}}
\State{\textit{UPDATE} velocities and mass fluxes using \textbf{(\ref{eq:nodeprime})}}
\If{(coupled scalar equation)}
  \State{\textit{SOLVE} scalar equation as described in section \ref{sec:discretetemperature}}
  \EndIf
\EndWhile
\If{(decoupled scalar equation)}
  \State{\textit{SOLVE} scalar equation as described in section \ref{sec:discretetemperature}}
  \EndIf
\end{algorithmic}
\end{algorithm}

\section{Discretization of the Mass Fluxes and the Pressure-Correction Equation}
\label{sec:segpresscorr}

Sections \ref{sec:massflux} and \ref{sec:simple} introduced the concept of pressure weighted interpolation to avoid oscillating results and an algorithm to calculate a velocity field that obeys continuity. The derived equations have not been discretized completely. Furthermore, the approach has not been generalized to non-orthogonal grids.

The discretized mass balance (\ref{eq:massbalance}) only depends on the normal velocities \(u_{i,f} n_{i,f}\). By analogy with equation (\ref{eq:facecorr2}), an interpolated normal face velocity, and thus the mass flux, can be calculated as follows
\begin{align}
  \label{eq:facecorr3}
  u_{i,f}^{(n*)} n_{i,f}
  &=
  \left[\left(1 - \gamma_f\right) u_{i,P}^{(n*)} + \gamma_f u_{i,Q}^{(n*)} \right]n_{i,f} \nonumber\\[1em]
  &\quad\quad - 
  \left(\left(1 - \gamma_f\right) \frac{\alpha_\vec{u} V_P}{a_P^{u_i}} + \gamma_f \frac{\alpha_\vec{u} V_Q}{a_Q^{u_i}}\right)
  \left[ 
  \left(\frac{\partial p}{\partial n}\right)_f^{(n-1)} 
  -  \frac{1}{2} \left( \frac{\partial p}{\partial n} \right)_P^{(n-1)} 
  -  \frac{1}{2} \left(\frac{\partial p}{\partial n}\right)_Q^{(n-1)} 
\right] \nonumber \\[1em]
&\quad\quad + \left(1 - \alpha_\vec{u}\right) \left[ u_{i,f}^{(n-1)} - \left(1 - \gamma_f\right) u_{i,P}^{(n-1)} - \gamma_f \, u_{i,Q}^{(n-1)} \right] n_{i,f}.
\end{align}
Here, the scalar product of the pressure gradient and the normal vector has been replaced by a directional derivative in the direction of the face unit normal vector. In the present work, the pressure gradients in (\ref{eq:facecorr3}) and the pressure-correction gradients in equation (\ref{eq:presscorr}) will be discretized by central differences
\begin{displaymath}
\left(\frac{\partial p}{\partial n}\right)_f \approx \frac{p_P - p_Q}{\left(\vec{x}_P - \vec{x}_Q\right)\cdot \vec{n}_f} 
\quad \text{and} \quad 
\left(\frac{\partial p'}{\partial n}\right)_f \approx \frac{p_P' - p_Q'}{\left(\vec{x}_P - \vec{x}_Q\right)\cdot \vec{n}_f}.
\end{displaymath}
In the next step, this discretization can be inserted into the semi-discretized pressure-correction equation (\ref{eq:presscorr}) 
\begin{displaymath}
%   \label{eq:discpresscorr}
  \sum_{F \in NB(P)} \left(\left(1 - \gamma_f\right) \frac{\alpha_\vec{u} V_P}{a_P^{u_i}} + \gamma_f \frac{\alpha_\vec{u} V_F}{a_F^{u_i}}\right)
   \frac{p_P' - p_F'}{\left(\vec{x}_P - \vec{x}_F\right)\cdot \vec{n}_f} S_f
  = b_{P,p}.
\end{displaymath}
The resulting coefficients for the pressure-correction equation,
\begin{displaymath}
  a_P^{p'} p_{P}' + \sum_{F \in NB(P)} a_F^{p'} p_{F}' = b_{P,p'},
\end{displaymath}
can be calculated as follows
\begin{equation}
  \label{eq:segpresscorrcoeff}
  a_F^{p'} = -\left(\left(1 - \gamma_f\right) \frac{\alpha_\vec{u} V_P}{a_P^{u_i}} + \gamma_f \frac{\alpha_\vec{u} V_F}{a_F^{u_i}}\right) \frac{S_f}{\left(\vec{x}_P - \vec{x}_F\right) \cdot \vec{n}_f} \quad \text{and} \quad
  a_P^{p'} = - \sum_{F \in NB(P)} a_F^{p'}.
\end{equation}
The right-hand side can be calculated as in equation (\ref{eq:presscorrb}) if the presented discretization is applied. 

\section{Discretization of the Momentum Balance}
\label{sec:segdiscretization}

If the stationary momentum balance is integrated over a single control volume \(P\), the result reads
\begin{equation}
  \label{eq:semidiscrete}
  \underbrace{\iint\limits_S (\rho u_i u_j)n_j \mathrm{d}S}_{\text{convective term}}
  \,- \underbrace{\iint\limits_S \left(\mu \left( \frac{\partial u_i}{\partial x_j} + \frac{\partial u_j}{\partial x_i}\right)\right)n_j \mathrm{d}S}_{\text{diffusive term}}
  = - \underbrace{\iiint\limits_V \frac{\partial p}{\partial x_i} \mathrm{d}V}_{\text{pressure source term}}
  - \underbrace{\iiint\limits_V \rho \beta \left(T - T_0\right) g_i \mathrm{d}V}_{\text{temperature source term}}.
\end{equation}
Here, the different terms are indicated which will be addressed individually in the following subsections. Due to the stationarity of the flow problems to be solved the terms of equations (\ref{eq:completeset}) involving time derivatives have been ignored. The form of equation (\ref{eq:semidiscrete}) has been derived by using Gauss's theorem of integration. The terms residing on the left will be dealt with in an implicit and, due to deferred corrections, also in an explicit way, whereas the terms on the right will be treated exclusively in an explicit way.

\subsection{Linearization and Discretization of the Convective Term}
\label{sec:segconvective}

The convective term \(\left( \rho u_i u_j \right)\) of the Navier-Stokes equations is the reason for the nonlinearity of the equations. In order to deduce a set of linear algebraic equations from the Navier-Stokes equations, this term has to be linearized. As introduced in section (\ref{sec:nonlinear}), the Picard iteration process will address the nonlinearity. Therefore, the part dependent on the non-dominant dependent variable, will be approximated with its value from the previous iteration as \( \rho u_i^{(n)} u_j^{(n)} \approx \rho u_i^{(n)} u_j^{(n-1)} \). However, this linearization will not be directly visible, because it will be covered by the mass flux \(\textstyle \dot{m}_f = \iint\limits_{S_f} \rho u_j^{(n-1)} n_j \mathrm{d}S \). 

Using the additivity of the Riemann integral, the first step is to decompose the surface integral into individual contributions from each boundary face of the control volume \(P\)
\begin{displaymath}
  \iint\limits_S \left(\rho u_i u_j \right) n_j \mathrm{d}S
  = \sum_{f \in \{w,s,b,t,n,e\}} \iint\limits_{S_f} \left(\rho u_{i} u_{j}\right) n_{j} \mathrm{d}S
  = \sum_{f \in \{w,s,b,t,n,e\}} F_{i,f}^{c},
\end{displaymath}
where \(\textstyle F_{i,f}^c := \iint\limits_{S_f} \left(\rho u_{i}^{(n)} u_{j}^{(n-1)}\right) n_{j} \mathrm{d}S \) is the convective flux of the velocity \(u_i\) through the boundary face \(S_f\). 
      
To improve diagonal dominance of the resulting linear system, while maintaining the smaller discretization error of a higher order discretization, a blended discretization scheme is combined with a deferred correction. Since, due to the nonlinearity of the equations to be solved, an iterative solution process is needed by all means, the overall convergence does not degrade noticeably by the application of a deferred correction \cite{ferziger02}. Blending and deferred correction result in a decomposition of the convective flux into a lower order approximation, which is treated implicitly, and an explicit difference between the higher and lower order approximation for the same convective flux. The use of higher order approximations on coarse grids may lead to oscillations in the solution. This fact in turn may deteriorate or even impede convergence. In order to prevent this degradation of convergence, a control factor \( \eta \in [0,1]\) can blend implicit and explicit schemes. Furthermore, the use of low-order approximations increases the diagonal dominance of the matrix, which in turn can improve the convergence of certain iterative solvers for the linear systems \cite{schaefer99}.

To show the generality of this approach, all further derivations are presented for the generic boundary face \(S_f\) which separates control volume \(P\) from its neighbor \(F \in NB(P)\). The fluxes can be decomposed as follows
\begin{equation}
  \label{eq:flowdecomp}
  F_{i,f}^c \approx  \underbrace{F_{i,f}^{c,l}}_{\text{implicit}} + \eta \, \bigl[\underbrace{ F_{i,f}^{c,h} - F_{i,f}^{c,l} }_{\text{explicit}}\bigr]^{(n-1)}.
\end{equation}
The convective fluxes carrying an \(l\) for \emph{lower} or an \(h\) for \emph{higher} as exponent, already have been linearized and discretized. The discretization applied to the convective flux in the present work is using the midpoint integration rule and blends the upwind interpolation scheme with a linear interpolation scheme. Using the decomposition from equation (\ref{eq:flowdecomp}), one can derive the following approximations
\begin{align*}
  F_{i,f}^{c,l} &= u_{i,F} \min(\dot{m}_f ,0) + u_{i,P} \max(0,\dot{m}_f) \\
  F_{i,f}^{c,h} &= \dot{m}_f \, \gamma_f \, u_{i,F} +  \dot{m}_f \, (1 - \gamma_f) \, u_{i,P},
\end{align*}
where, the variable values may have to be taken from the previous iteration step \((n-1)\) as described in equation (\ref{eq:flowdecomp}) and the mass flux \(\dot{m}_f\) has been calculated as result of the linearization process. Now, the results are summarized by presenting the convective contribution to the matrix coefficients \(a_{F}^{u_i}\) and \(a_P^{u_i}\) and the right-hand side \(b_{P,u_i}\) as
%\begin{subequations}
\begin{align*}
  a_F^{u_i,c} &= \min(\dot{m}_f ,0), \quad \quad a_P^{u_i,c} = \sum_{F \in NB(P)} \max(0,\dot{m}_f) \\[1em]
  \text{and} \quad b_{P,u_i}^c &= \sum_{F \in NB(P)} \eta  \left(u_{i,F}^{(n-1)} \left( \min(\dot{m}_f,0) - \dot{m}_f \gamma_f \right)\right)
  + \eta \left( u_{i,P}^{(n-1)} \left( \max(0,\dot{m}_f) - \dot{m}_f \left(1 - \gamma_f\right) \right)\right).
\end{align*}
%\end{subequations}

\subsection{Discretization of the Diffusive Term}

The diffusive term contains the first partial derivatives of the velocity as a result of the material constitutive equation that characterizes the behavior of Newtonian fluids. As section \ref{sec:nonorth} points out, directional derivatives can be discretized using central differences on orthogonal grids. In the universal case of non-orthogonal grids, the discretization can be carried out using implicit central differences and an explicit deferred correction which addresses the non-orthogonality of the grid. As seen in equation (\ref{eq:navierstokes}), the diffusive term of the Navier-Stokes equations can be simplified using the mass balance for the case of an incompressible flow with constant viscosity \(\mu\). In order to preserve the general validity of the presented approach, this simplification will be omitted.

As before, by using the additivity and furthermore linearity of the Riemann integral, the integration of the diffusive term will be divided into integrations over the individual boundary faces \(S_f\) 
\begin{displaymath}
  \iint\limits_S \left(\mu \left( \frac{\partial u_i}{\partial x_j} + \frac{\partial u_j}{\partial x_i}\right)\right)n_j \mathrm{d}S 
  = \sum_{f \in \{w,s,b,t,n,e\}} \left[
    \iint\limits_{S_f} \mu \underline{\frac{\partial u_i}{\partial x_j}n_j \mathrm{d}S}
  + \iint\limits_{S_f} \mu \frac{\partial u_j}{\partial x_i}n_j \mathrm{d}S \right]
   = \sum_{f \in \{w,s,b,t,n,e\}} F_{i,f}^{d}.
\end{displaymath}
Here, \(F_{i,f}^{d}\) denotes the diffusive flux through an individual boundary face. Section \ref{sec:nonorth} only covered the non-orthogonal corrector for directional derivatives. Since the velocity is a vector field and not a scalar field, the results of section \ref{sec:nonorth} may only be applied to the underlined term. The other term will be treated explicitly since its sum over all boundary faces is considerably smaller than the underlined term. Furthermore, the explicit term does not cause oscillations and thus will not deteriorate convergence \cite{ferziger02}. All present integrals will be approximated using the midpoint integration rule. The diffusive flux \(F_{i,f}^d\) for the generic face \(S_f\), located between the control volumes \(P\) and \(F\), reads as follows
\begin{displaymath}
  F_{i,f}^d \approx \mu \underline{\left(\frac{\partial u_i}{\partial x_j}\right)_f n_j S_f} + \mu \left(\frac{\partial u_j}{\partial x_i}\right)_f n_j S_f.
\end{displaymath}

By using central differences for the implicit discretization of the directional derivative and by using the \emph{orthogonal correction} approach from section \ref{seq:orthcorrapproach}, the approximation can be derived as follows
\begin{align*}
  F_{i,f}^d 
  &\approx 
  \mu \left( \underline{||\vecg{\vecg{\Delta}_f}||_2 \frac{u_{i,P} - u_{i,F}}{ || \vec{x}_P - \vec{x}_F ||_2 }  
  -  \left(\nabla u_i \right)_f^{(n-1)} \cdot \left(\vecg{\Delta}_f - \vec{S}_f\right)  }  \right)
  + \mu \left( \frac{\partial u_j}{\partial x_i} \right)_f^{(n-1)} n_{f_i} \\[1em]
  &= \mu \left(\underline{  S_f \frac{u_{i,P} - u_{i,F}}{ || \vec{x}_P - \vec{x}_F ||_2 }  
  - \left( \frac{\partial u_i}{\partial x_j}\right)_f^{(n-1)} \left(\xi_{f_i} - n_{f_i}\right)S_f  } \right)
  + \mu \left( \frac{\partial u_j}{\partial x_i} \right)_f^{(n-1)} n_{f_i}.
\end{align*}
Here, the unit vector pointing \(\vecg{xi}_f = \left({\xi_f}_i\right)_{i = 1,\dots,3}\) in the direction of the straight line, which connects control volume \(P\) and control volume \(F\) is denoted as follows
\begin{displaymath}
  \vecg{\xi}_f = \frac{\vec{x}_P - \vec{x}_F}{|| \vec{x}_p - \vec{x}_F ||_2}.
\end{displaymath}
The interpolation of the cell center gradients to the boundary faces is performed as in equation (\ref{eq:interpolgrad}). Now, the contribution of the diffusive part to the matrix coefficients and the right-hand side can be calculated as
%\begin{subequations}
\begin{align*}
  a_F^{u_i,d} &= - \frac{\mu S_f}{||\vec{x}_P - \vec{x}_F||_2}, 
  \quad \quad a_P^{u_i,d} = \sum_{F \in NB(P)} \frac{\mu S_f}{|| \vec{x}_P - \vec{x}_F ||} \\[1em]
  b_{F,u_i}^d &=  - \sum_{F \in NB(P)} \left( \frac{\partial u_i}{\partial x_j}\right)_f^{(n-1)} \left(\xi_{f_i} + n_{f_i}\right)S_f  
  - \mu \left( \frac{\partial u_j}{\partial x_i} \right)_f^{(n-1)} n_{f_i} S_f   \nonumber \\[0.5em]
  &=  - \sum_{F \in NB(P)} \left( \frac{\partial u_i}{\partial x_j}\right)_f^{(n-1)} \xi_{f_i} S_f
  + \mu \left( \left( \frac{\partial u_i}{\partial x_j} \right)_f^{(n-1)}
  + \left( \frac{\partial u_j}{\partial x_i} \right)_f^{(n-1)} \right) n_{f_i} S_f.
\end{align*}
%\end{subequations}

\subsection{Discretization of the Source Terms}

Since in the segregated solution approach in every equation all other variables but the dominant one are treated as constants, and the source terms in equation (\ref{eq:semidiscrete}) do not depend on the dominant variable, the discretization is straightforward. The source terms of the momentum balance are discretized using the midpoint integration rule for volume integrals. This discretization leads to the source term
\begin{displaymath}
  - \iiint\limits_V \frac{\partial p}{\partial x_i} \mathrm{d}V
  - \iiint\limits_V \rho \beta \left(T - T_0\right) g_i \mathrm{d}V
  \approx
  - \left(\frac{\partial p}{\partial x_i}\right)_P^{(n-1)} V_P
  - \rho \beta \left(T_P^{(n-1)} - T_0\right) g_i V_P
  = b_{P,u_i}^{sc}.
\end{displaymath}

\section{Discretization of the Temperature Equation}
\label{sec:discretetemperature}

The discretization of the stationary temperature equation is performed by the same means as for the momentum balance. The only difference is a simpler diffusion term. Having applied Gauss's theorem of integration, the integral form of the temperature equation reads as follows
\begin{displaymath}
  \underbrace{ \iint\limits_S \rho u_j T n_j \mathrm{d}S }_{\text{advective term}}
  - \underbrace{ \iint\limits_S \kappa \frac{\partial T}{\partial x_j} n_j \mathrm{d}V }_{\text{diffusive term}}
  = \underbrace{\iiint\limits_V \vphantom{\frac{ T}{ x_j} } q_T \mathrm{d}V }_{\text{source term}}.
\end{displaymath}
Now, proceeding as in the preceding sections, one can discretize the advective term, the diffusive term, and the source term. Since this process does not provide further insight, only the final results will be presented. The discretization yields the matrix coefficients as
%\begin{subequations}
  \begin{align*}
    a_F^{T} &= \min(\dot{m}_f,0) + \frac{\kappa S_f}{||\vec{x}_P - \vec{x}_F||_2} \\[1em]
    a_P^{T} &= \sum_{F \in NB(P)}\max(0,\dot{m}_f) - \frac{\kappa S_f}{||\vec{x}_P - \vec{x}_F||_2} \\[1em]
    b_{P,T} &= \sum_{F \in NB(P)} \eta  \left(T_F^{(n-1)} \left( \min(\dot{m}_f,0) - \dot{m}_f \gamma_f \right)\right) 
                                + \eta \left( T_{P}^{(n-1)} \left( \max(0,\dot{m}_f) - \dot{m}_f \left(1 - \gamma_f\right) \right)\right) \nonumber \\[0.5em]
            &\quad + \sum_{F \in NB(P)} \kappa \left( \frac{\partial T}{\partial x_j}\right)_f^{(n-1)} \left(\xi_{f_j} - n_{f_j}\right)S_f \nonumber \\[0.5em]
            &\quad + q_{T_P} V_P.
  \end{align*}
%\end{subequations}
Again it is possible though not always as necessary as in the case of the velocities, to under-relax the solution of the resulting linear system with an under-relaxation factor \(\alpha_T\). Section \ref{sec:structure} shows how to accomplish implicit under-relaxation of variables.

\section{Boundary Conditions}
\label{sec:segboundary}

As the antecedent sections showed, it is possible to deduce a linear algebraic equation for each control volume by the finite-volume method. However, the approach presented in the preceding sections did not cover the treatment of control volumes at domain boundaries. Hence, this section introduces the boundary conditions which are relevant for the present work and deals with transitional conditions at block boundaries.

\subsection{Dirichlet Boundary Conditions}
\label{sec:segDirichlet}

The first boundary condition is the Dirichlet boundary condition. This type of boundary condition, when used for the velocity or transported scalars, is used to model inlet conditions for flow problems. For the temperature equation, it may also be used at walls, as will be shown in subsection \ref{sec:walls}. The Dirichlet boundary condition is characterized by explicitly specifying the value of the variable for which the equation is solved. As a result, boundary fluxes can be calculated directly. In the case of Dirichlet boundary conditions for the velocities, especially the mass flux \(\dot{m}_f\) is known and hence does not have to be calculated using the pressure weighted interpolation method. This fact furthermore implies that the boundary velocities do not have to be corrected at Dirichlet velocity boundaries, i.e. equation (\ref{eq:velcorr}) yields
\begin{displaymath}
  0 
  =
  u_{i,f}' 
  = 
  - \left(\left(1 - \gamma_f\right) \frac{\alpha_\vec{u} V_P}{a_P^{u_i}} + \gamma_f \frac{\alpha_\vec{u} V_Q}{a_Q^{u_i}}\right)
  \left(\frac{\partial p}{\partial x_i}\right)_f'
\end{displaymath}
which implies
\begin{equation}
  \label{eq:dirichletneumann}
  \left(\frac{\partial p}{\partial x_i}\right)_f' = 0.
\end{equation}
Equation (\ref{eq:dirichletneumann}) shows that a Neumann zero gradient boundary condition applies to the pressure-correction at Dirichlet velocity boundaries.

In the case of Dirichlet boundary conditions for the velocities or the temperature, the coefficient corresponding to an imaginary neighboring control volume laying past the boundary is considered as an explicit contribution to the right-hand side of the linear system. Since no modifications to the discretized equations have to be considered, the implementation approach for inlet boundary conditions will be presented for the temperature equation only. At Dirichlet boundaries the Furthermore, there is no boundary condition that fixes the gradient at Dirichlet boundaries. In this case, it is common to assume that the partial derivatives of the respective variable are constant and can be extrapolated as follows
\begin{displaymath}
  \left( \frac{\partial T}{\partial x_j} \right)_f \approx \left( \frac{\partial T}{\partial x_j} \right)_P.
\end{displaymath}
The modification of the central coefficient of the linear equation can be formulated recursively as
\begin{equation}
  \label{eq:dirichletcoeff}
  a_P^{T} = a_P^{T} + \left( \max(0,\dot{m}_f )  - \frac{\kappa S_f}{|| \vec{x}_P - \vec{x}_f ||_2} \right),
\end{equation}
whereas the contribution to the right-hand side reads as follows
\begin{align}
  \label{eq:dirichletrhs}
  b_{P,T} &= b_{P,T} - \left( \min(\dot{m}_f,0) - \frac{\kappa S_f}{||\vec{x}_P - \vec{x}_f||_2}\right) T_f +
  \left( \frac{\partial T}{\partial x_j}\right)_P^{(n-1)} \left(\xi_{f_j} - n_{f_j}\right)S_f.
\end{align}
Equations (\ref{eq:dirichletcoeff}) and (\ref{eq:dirichletrhs}) show, that a blending factor \(\eta = 0\) is used. Even though the gradient discretization at domain boundaries is realized by a one-sided forward differencing scheme instead of a central differencing scheme, this does not drastically affect accuracy, because the distance used in the differential quotient is about half the distance used within a central difference inside the domain \cite{schaefer99}.

The case of Dirichlet boundary conditions for the pressure needs special consideration since no equation for the pressure is solved but instead an equation for the pressure-correction. This type of boundary condition can be applied to inlet boundaries or pressure boundaries and is recommendable if, on the one hand, the velocity distribution is unknown, but, on the other hand, the pressure difference between inlet and outlet, or the reference pressure at the outlet is a known quantity. The pressure-correction at Dirichlet pressure boundaries is assumed to \(p' = 0\), and the modification of the coefficients of the algebraic equation for the corresponding control volumes can be carried out as in equations (\ref{eq:dirichletcoeff}) and (\ref{eq:dirichletrhs}). The velocity correction at the boundaries is nonzero and will have to be extrapolated using the formula for the pressure weighted interpolation applied to boundary values (\ref{eq:faceprime}). Even though Dirichlet boundary conditions for the pressure would correspond to Neumann boundary conditions for the velocities, a Dirichlet boundary condition for the velocities is used as well, using an extrapolated velocity value as fixed value for the calculation of boundary fluxes in the momentum balances. 

\subsection{Treatment of Wall Boundaries}
\label{sec:walls}
    
Solid, impermeable walls represent a common boundary for the solution domain. This boundary condition first of all has a kinematic character since the concept of impermeable walls dictates a zero normal velocity at the wall. In viscous flows, wall boundaries can be interpreted furthermore as a no-slip condition, i.e. a Dirichlet boundary condition for the tangential velocities. Convective fluxes through solid walls are thus zero by definition. However, the diffusive fluxes of the velocities and the temperature require special consideration. The correct approximation of fluid behavior on a wall boundary requires modifying the diffusive terms of the momentum balance. Furthermore, diffusive fluxes for the temperature can be given by Neumann or Dirichlet boundary conditions.

The derivation of the discretized diffusive flux through wall boundaries starts from the integral momentum balance (\ref{eq:cauchy}) for the vector \(\vec{u}\). Here, only the term for surface forces is needed
\begin{displaymath}
  \vec{F}_w =  \iint\limits_{S_w} \vec{t} \mathrm{d}S = \iint\limits_{S_w} \vec{T}(\vec{n}_w) \mathrm{d}S.
\end{displaymath}
For the purpose of treating wall boundary conditions, it is appropriate to use a local coordinate system \(n,t,s\), where \(n\) denotes the wall-normal coordinate, \(t\) denotes the coordinate tangential to the wall shear force and, \(s\) is the binormal coordinate. With respect to this coordinate system, the wall-normal vector is represented by \(\vec{n}_w = \left( 1, 0 , 0 \right)^T\) and the image of the wall-normal vector \(\vec{T}(\vec{n_w})\) is represented by 
\begin{displaymath}
\vec{T}(\vec{n}_w) =
\left[
  \begin{array}{ccc}
    \tau_{nn} & \tau_{nt} & \tau_{ns}\\
    \tau_{nt} & \tau_{tt} & \tau_{ts}\\
    \tau_{ns} & \tau_{ts} & \tau_{ss}
  \end{array}
\right]
\left[
\begin{array}{c}
  1\\
  0\\
  0
\end{array}
\right]
=
\left[
\begin{array}{c}
  \tau_{nn}\\
  \tau_{nt}\\
  \tau_{ns}
\end{array}
\right].
\end{displaymath}
The velocity of the wall is assumed to be constant \cite{schaefer99}, what implies that the directional derivative of the tangential velocity vanishes on the wall
\begin{displaymath}
  \tau_{tt} =  \frac{ \partial u_t }{ \partial x_t }  =  0,
\end{displaymath}
which, together with the continuity equation in differential form (\ref{eq:contifull}), leads to
\begin{equation}
  \label{eq:contiwall}
 \frac{ \partial u_n }{ \partial x_n } + \frac{ \partial u_t }{ \partial x_t } =  \frac{ \partial u_n }{ \partial x_n } = 0,
\end{equation}
what is equivalent to \( \tau_{nn} = 0\) at the wall. The velocity is assumed to have no component in the binormal direction. A physical interpretation of (\ref{eq:contiwall}) would be that the transfer of momentum at the wall occurs by shear forces exclusively. Furthermore, the coordinate direction \(t\) is chosen to be parallel to the shear force.  This choice does not represent a restriction, because of the possibility to rotate the coordinate system within the plane. This choice of \(t\) leads to \( \tau_{ns} = 0 \). Hence, the absolute value of the surface force only depends on the normal derivative of the velocity tangential to the wall. After transforming the coordinates back to the system \((x_1, x_2, x_3)\) the surface force can be calculated, and the integral can be discretized using the midpoint integration rule 
\begin{equation}
  \label{eq:wallforce}
  \vec{F}_w 
  =  
  \iint\limits_{S_w} \vec{t_w} \, \tau_{nt} \mathrm{d}S
  =
  \iint\limits_{S_w} \vec{t_w} \, \mu \frac{\partial u_t}{\partial n} \mathrm{d}S
  =
  \vec{t_w} \, \mu \left(\frac{\partial u_t}{\partial n}\right)_w S_w,
\end{equation}
where \( \vec{t_w} \) denotes the transformed tangential vector \((0,1,0)^T\) with respect to the coordinate system \((x_1,x_2,x_3)\). In the discretization process, this tangential vector will be calculated from the velocity vector as
\begin{displaymath}
  \vec{t_w} = \frac{\vec{u}_t}{|| \vec{u}_t ||_2} \quad \text{, where} \quad \vec{u}_t = \vec{u} - \left( \vec{u} \cdot \vec{n}_w \right) \vec{n}_w.
\end{displaymath}

According to \cite{ferziger02} this force should not be handled explicitly for convergence reasons. If surface forces are expressed in terms of the velocities \(u_i\), the discretization process leads to different central matrix coefficients, which in turn deteriorates memory efficiency.

The discretization approach used in the present thesis uses a simpler implicit discretization coupled with a deferred correction which combines the explicit discretization of the surface force (\ref{eq:wallforce}) with a central difference. At first, the contained directional derivative is discretized implicitly by
\begin{displaymath}
  \left(\frac{\partial u_t}{\partial n}\right) {t_w}_i
  \approx
  \left(\frac{\partial u_i}{\partial \xi}\right)
  \approx
  \frac{u_{i,P} - u_{i,w}}{|| \vec{x}_P - \vec{x}_w ||_2}
\end{displaymath}
and explicitly by
\begin{displaymath}
  \left(\frac{\partial u_t}{\partial n}\right) {t_w}_i
  \approx
  \frac{\left(u_{i,P}- u_{i,w} \right) - \left(u_{j,P} - u_{j,w}\right) n_j n_i  }{\left( \vec{x}_P - \vec{x}_w \right) \cdot \vec{n}_w}.
\end{displaymath}
Therefore, the contributions to the central coefficient and the right-hand side of the linear equation that results from the presented discretization process read
\begin{align*}
  a_P^{u_i} &= a_P^{u_i} + \mu \frac{S_f}{|| \vec{x}_P - \vec{x}_w ||_2} \quad \text{and} \\
  b_{P,u_i} &= b_P^{u_i} + \mu \frac{S_f}{|| \vec{x}_P - \vec{x}_w ||_2} u_{i,P}^{(n-1)} + 
  \mu \, \frac{\left(u_{i,P}^{(n-1)}- u_{i,w} \right) - \left(u_{j,P}^{(n-1)} - u_{j,w}\right) n_j n_i  }{\left( \vec{x}_P - \vec{x}_w \right) \cdot \vec{n}_w}.
\end{align*}
Since the deferred correction uses a Dirichlet boundary condition, no correction of the value of the wall velocity \(u_{i,w}\) has to be accounted for.

If the solution of the flow field is coupled to the solution of a temperature equation, different options for the boundary condition at walls may be chosen. If, on the one hand, the wall temperature is known, a Dirichlet boundary condition for the temperature is the choice. A wall of this type is called to be \emph{isothermal}. If, on the other hand, only the heat flux is known, a Neumann boundary condition is used. In the special case of zero heat flux, the wall is called to be \emph{adiabatic}. Besides isothermal walls, the present thesis uses adiabatic walls. The implementation of isothermal walls is straightforward since no new coefficients for the temperature equation have to be calculated.

\subsection{Treatment of Block Boundaries}
\label{sec:blockboundaries}

If structured grids are used to decompose the problem domain, the characterizing property of structured grids, which is the constant amount of grid cells in each direction, gives each inner cell exactly six neighbors. If block-structured grids are used, this property may be violated if the number of grid cells of each block is chosen to be arbitrary. The arbitrariness of the grid resolution is a main benefactor for the adaptivity of block-structured grids. Arbitrary grid resolutions may lead to \emph{hanging} nodes at block boundaries which are not addressed by the previously presented discretization techniques. How a solution algorithm for partial differential equations via finite-volume methods can deal with block boundaries, is presented in this subsection.

To maintain the conservation property of finite-volume methods \cite{schaefer99}, block boundaries should not be interpreted as boundaries in the classical sense. Instead, conditions have to be formulated to guarantee that flows through block boundaries are conserved. The method to treat block boundaries which is used in the present thesis was presented by \cite{lilek97}. A different method was described in \cite{lange02}. However, the first method was chosen since it allows for a fully implicit discretization of the block boundary fluxes. This method calculates fluxes through separate face segments \(S_l\) that surge from \emph{non-matching} grid blocks. Each of these face segments gets assigned a control volume \(L\) and a control volume \(R\), which exclusively share this face segment. An algorithm to provide the information associated with these face segments has been implemented in the present thesis. Figure \ref{fig:nonmatching} shows an example of non-matching block boundaries and the used indexing for control volumes and boundary faces. This indexing is based on a numbering of the face segments \(S_l\).

\begin{figure}
  \centering
  \input{./img/nonmatching.tikz.tex}
  \caption{Non-matching grid cells with hanging nodes at a two-dimensional block boundary. Indexing is based on the face segments $S_l$}
  \label{fig:nonmatching}
\end{figure}

Once the geometric data, including the information regarding the interpolation coefficients at block boundaries, has been provided, the fluxes through these boundaries can be calculated as presented in the antecedent subsections. The coefficients in the linear system corresponding to the connectivity of neighboring control volumes of different grid blocks is represented by matrix coefficients \(a_L^{\phi}\) and \(a_R^{\phi}\), where \(\phi \in \{u_1,u_2,u_3,p,T\}\).

\section{Treatment of the Singularity of the Pressure-Correction Equation with Neumann Boundaries}
\label{sec:singularitytreatment}

The derived pressure-correction equation is a Poisson equation. As can be proven \cite{hackbusch96}, the linear \(N \times N\) systems surging from the presented discretization on a grid with \(N\) control volumes with Neumann boundary conditions have a kernel of dimension one, i.e.
\begin{displaymath}
  \operatorname{ker}\,(A_{p'}) = \operatorname{span}(\mathbb{1}),
\end{displaymath}
where \(\mathbb{1} = (1)_{i = 1,\dots,N} \in \mathbb{R}^N\) is the vector spanning the kernel. This singularity accounts for the property of incompressible flows that pressure can only be determined up to a constant. To fix this constraint, various possibilities exist \cite{ferziger02}. A common method is to set the pressure-correction to zero in one reference control volume which corresponds to fixing the pressure at one reference point in the problem domain. The fixation of the pressure can be done before solving the system by applying this Dirichlet-type condition, or it can be done afterward, when pressure is calculated from the pressure-correction. This approach is not suitable for grid convergence studies since, without special interpolation, it does not guarantee that the reference pressure-correction is taken at the correct location throughout the different grid levels.

Since some comparisons performed in the present work rely on grid convergence studies, another approach for reducing the lose constraint of the pressure-correction system is used: The reference pressure-correction is taken to be the mean value of the pressure-correction over the domain 
\begin{displaymath}
  p_{\text{ref}}' 
  = \frac{\iiint\limits_V p' \mathrm{d}V}{\iiint\limits_V \mathrm{d}V} 
    \approx \frac{\sum_{P = 1}^N p'_P V_P}{\sum_{P = 1}^N V_P}.
\end{displaymath}
Consequently, the net pressure-correction amounts to zero. By using this fact equation (\ref{eq:pressupdate}) can be modified as follows
\begin{displaymath}
  %\label{eq:pressupdate2}
  p_P^{(n)} = p_P^{(n-1)} + \alpha_{\vec{p}} \left( p_P' - p_{\text{ref}}' \right).
\end{displaymath}
As soon as one control volume has been provided with a Dirichlet pressure boundary condition, the system is not singular anymore. For example, this is the case with fixed pressure at inlet or outlet boundary conditions, which have both been presented in section \ref{sec:segDirichlet}.

\section{Structure of the Assembled Linear Systems}
\label{sec:structure}

The objective of a finite-volume method is to create a set of linear algebraic equations from a discretization of partial differential equations. In the case of the discretized momentum balance, taking all contributions together, this discretization leads to the following linear algebraic equation for each control volume \(P\)
\begin{displaymath}
  a_P^{u_i} u_{P_i} + \sum_{F \in NB(P)} a_F u_{F_i} = b_{P,u_i}.
\end{displaymath}
Here, the coefficients are composed as follows
%\begin{subequations}
\begin{align*}
  a_P^{u_i} &= a_P^{u_i,c} - a_P^{u_i,d} \\
  a_F^{u_i} &= a_F^{u_i,c} - a_F^{u_i,d} \\
  b_{P,u_i} &= b_{P,u_i}^{c} - b_{P,u_i}^{d} + b_{P,u_i}^{sc}.
\end{align*}
%\end{subequations}
Similar expressions for the pressure-correction equation and the temperature equation can be deduced. In the case of control volumes located at boundaries some of the coefficients will be calculated in a different way. This aspect has been addressed in section \ref{sec:segboundary}.

For the decoupled iterative solution process of the Navier-Stokes equations, it is necessary to reduce the change of each dependent variable in each iteration. Normally this is done by an implicit \emph{under-relaxation} technique, a convex combination of the solution of the linear system for the present iteration \((n)\) and from the previous iteration \((n-1)\), with the under-relaxation parameter \(\alpha_{u_i} \in (0,1]\), where \(\alpha_{u_i} = 1\) corresponds to no under-relaxation. Generally speaking, this parameter can be chosen individually for each equation. Since there are no rules for choosing these parameters in a general setting, the under-relaxation parameter for the velocities is chosen to be equal for all three velocities, \(\alpha_{u_i} = \alpha_{\vec{u}}\) \cite{schaefer99}. This choice of velocity under-relaxation has the further advantage that, in case the boundary conditions are implemented with the same intention, the linear system for each of the velocities remains unchanged except for the right-hand side. This fact helps to increase memory efficiency.

Let the solution for the linear system without under-relaxation be denoted as
\begin{displaymath}
  \tilde{u}_{P_i}^{(n)} := \frac{b_{P,u_i} - \sum_{F \in NB(P)} a_F u_{F_i}}{a_P^{u_i}}.
\end{displaymath}
This equation is only a formal expression for the case, in which the linear system for the velocity component \(u_i\) is solved directly. The described convex combination yields
\begin{align*}
  u_{P_i}^{(n)} :&= \alpha_{\vec{u}} \tilde{u}_{P_i}^{(n)} + (1 - \alpha_{\vec{u}} )\, u_{P_i}^{(n-1)} \\[0.5em]
                 &= \alpha_{\vec{u}} \frac{b_{P,u_i} - \sum_{F \in NB(P)} a_F u_{F_i}}{a_P^{u_i}} + (1 - \alpha_{\vec{u}} )\, u_{P_i}^{(n-1)},
\end{align*}
an expression that can be modified to derive a linear system whose solution is the under-relaxed velocity
\begin{displaymath}
  \frac{a_P^{u_i}}{\alpha_{\vec{u}}} u_{i,P} + \sum_{F \in NB(P)} a_F^{u_i} u_{i,F} 
  = 
  b_{P,u_i} + \frac{(1 - \alpha_{\vec{u}})\, a_P^{u_i}}{\alpha_{\vec{u}}}\, u_{i,P}^{(n-1)}. 
\end{displaymath}

After all matrix coefficients have been successfully calculated, the linear system can be represented by a system matrix \(A\) and a right-hand side vector \(b\). Figure \ref{fig:segassemble} shows the non-zero structure of a linear system for a grid consisting of a \(2\times2\times2\) cell block and a \(3\times3\times3\) cell block.

\begin{figure}
  \centering
  \input{./img/matrix.tikz.tex}
  \caption{Non-zero structure of the linear systems used in the SIMPLE-algorithm for a block-structured grid consisting of one $2\times2\times2$ cell block and one $3\times3\times3$ cell block as illustrated in Figure \ref{fig:blockstruc}}
  \label{fig:segassemble}
\end{figure}
